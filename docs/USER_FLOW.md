# 🍳 Kitchen Simulator - 유저 플로우
## User Flow Diagrams

> **대상**: UX 디자이너, 기획자, 개발자  
> **목적**: 사용자의 모든 동선과 상호작용을 시각화

---

## 📋 목차

1. [전체 게임 플로우](#1-전체-게임-플로우)
2. [메뉴 조리 플로우](#2-메뉴-조리-플로우)
3. [재료 투입 플로우](#3-재료-투입-플로우)
4. [온도 관리 플로우](#4-온도-관리-플로우)
5. [예외 상황 플로우](#5-예외-상황-플로우)
6. [화면 전환 플로우](#6-화면-전환-플로우)

---

## 1. 전체 게임 플로우

```
┌──────────────┐
│  게임 시작   │
└──────┬───────┘
       │
       ▼
┌──────────────────────────────────────┐
│         난이도 선택 화면             │
│  ┌──────────────────────────────┐   │
│  │ 신입 (3개 완료 목표)         │◀──┐
│  ├──────────────────────────────┤   │
│  │ 알바 (10개 완료 목표)        │   │ 사용자
│  ├──────────────────────────────┤   │ 클릭
│  │ 관리자 (20개 완료 목표)      │   │
│  └──────────────────────────────┘   │
└──────────────┬───────────────────────┘
               │
               ▼ [선택 완료]
┌──────────────────────────────────────┐
│      식자재 데이터 프리로딩          │
│  (2~3초 소요, 로딩 화면 표시)       │
└──────────────┬───────────────────────┘
               │
               ▼
┌──────────────────────────────────────┐
│         게임 플레이 화면             │
│                                      │
│  [타이머 시작] ──┬── [주문 생성]    │
│                  │                   │
│                  ├── [온도 업데이트] │
│                  │                   │
│                  └── [메뉴 타이머]   │
│                                      │
│  사용자 반복 액션:                   │
│    ① 주문 확인                       │
│    ② 화구 배정                       │
│    ③ 재료 투입                       │
│    ④ 조리 액션 (볶기/뒤집기 등)     │
│    ⑤ 온도 관리                       │
│    ⑥ 서빙                            │
│                                      │
│  완료 조건: 목표 개수 달성           │
└──────────────┬───────────────────────┘
               │
               ▼ [목표 달성]
┌──────────────────────────────────────┐
│         게임 종료 & 결과 화면        │
│                                      │
│  📊 레시피 정확도: 95%               │
│  ⏱️ 평균 시간: 6분 23초              │
│  🔥 화구 사용률: 78%                 │
│  🏆 총점: 92점                       │
│                                      │
│  [다시 하기] [메인으로] [종료]      │
└──────────────────────────────────────┘
```

---

## 2. 메뉴 조리 플로우

### 2.1 주문 접수 → 서빙 전체 과정

```
┌─────────────────────────────────────────────────────────────┐
│                   [주문 들어옴]                             │
│           🍜 계란볶음밥 (⏱️ 0:00)                           │
└───────────────────────┬─────────────────────────────────────┘
                        │
        ┌───────────────┴───────────────┐
        │                               │
        ▼ [WAITING 상태]                │
┌───────────────────────┐               │ 사용자
│   주문 대기 중        │               │ 무반응
│                       │               │
│ - 주문 카드에 표시    │◀──────────────┘
│ - 타이머 시작         │
│ - 배정 버튼 활성화    │
└───────┬───────────────┘
        │
        ▼ [사용자: 화구 선택]
┌───────────────────────────────────────┐
│        화구 배정 (COOKING 상태)       │
│                                       │
│ ① 웍 상태 확인                        │
│    - CLEAN이 아니면 배정 불가         │
│                                       │
│ ② 웍에 메뉴 할당                      │
│    - currentMenu: "계란볶음밥"        │
│    - currentStep: 0                   │
│    - 불 자동 점화 (isOn: true)        │
│                                       │
│ ③ 레시피 가이드 활성화                │
│    - 현재 스텝 표시                   │
└───────┬───────────────────────────────┘
        │
        ▼
┌───────────────────────────────────────┐
│          [조리 루프 시작]             │
└───────┬───────────────────────────────┘
        │
        │  ┌────────────────────────────┐
        └─→│  현재 스텝 확인            │
           │  (레시피 가이드 표시)      │
           └────┬───────────────────────┘
                │
                ├─→ [INGREDIENT 타입]
                │   │
                │   ├─→ 사용자: 냉장고/서랍/조미료대 열기
                │   │
                │   ├─→ 재료 선택
                │   │
                │   ├─→ 양 입력
                │   │
                │   ├─→ 검증 & 투입
                │   │   │
                │   │   ├─→ ✅ 정확함
                │   │   │   └─→ addedIngredients에 추가
                │   │   │
                │   │   └─→ ❌ 틀림
                │   │       ├─→ [신입] 차단, 다시 입력
                │   │       └─→ [알바/관리자] 오류 카운트++
                │   │
                │   └─→ 모든 재료 투입 완료?
                │       ├─→ Yes: currentStep++
                │       └─→ No: 계속 입력 대기
                │
                └─→ [ACTION 타입]
                    │
                    ├─→ 사용자: 웍 클릭 (래디얼 메뉴)
                    │
                    ├─→ 액션 선택 (볶기/뒤집기/물넣기)
                    │
                    ├─→ 검증 & 실행
                    │   │
                    │   ├─→ ✅ 정확함
                    │   │   └─→ currentStep++
                    │   │
                    │   └─→ ❌ 틀림
                    │       ├─→ [신입] 차단, 타이밍 오버 시 타버림
                    │       └─→ [알바/관리자] 오류 카운트++
                    │
                    └─→ currentStep++
                        │
                        ▼
                ┌───────────────────────────┐
                │ currentStep >= totalSteps?│
                └────┬──────────────┬────────┘
                     │              │
                No ──┘              └── Yes
                     │                   │
                     └─→ [조리 루프 반복] ▼
                                    ┌────────────────┐
                                    │ [서빙 가능]    │
                                    └────┬───────────┘
                                         │
                                         ▼ [사용자: 서빙 클릭]
                                    ┌────────────────────────┐
                                    │   점수 계산            │
                                    │                        │
                                    │ ① 시간 점수 계산       │
                                    │    - 조리 시간 측정    │
                                    │                        │
                                    │ ② 레시피 정확도 계산   │
                                    │    - 오류 횟수 확인    │
                                    │                        │
                                    │ ③ 최종 점수 = 평균     │
                                    └────┬───────────────────┘
                                         │
                                         ▼
                                    ┌────────────────────────┐
                                    │ [서빙 완료]            │
                                    │                        │
                                    │ - status: COMPLETED    │
                                    │ - 웍 state: DIRTY      │
                                    │ - completedMenus++     │
                                    │ - 3초 후 주문 카드 제거│
                                    └────────────────────────┘
```

### 2.2 신입 vs 알바/관리자 분기

```
[재료/액션 틀림]
      │
      ├─────────────────┬─────────────────┐
      │                 │                 │
 [신입 모드]       [알바 모드]       [관리자 모드]
      │                 │                 │
      ▼                 ▼                 ▼
┌──────────┐     ┌──────────┐     ┌──────────┐
│ 즉시 차단│     │오류 카운트│     │오류 카운트│
│          │     │   ++     │     │   ++     │
│경고 메시지│     │          │     │          │
│표시      │     │진행 허용 │     │진행 허용 │
│          │     │          │     │          │
│다시 입력 │     │서빙 시   │     │서빙 시   │
│대기      │     │정확도    │     │정확도    │
│          │     │표시      │     │표시      │
└──────────┘     └──────────┘     └──────────┘
```

---

## 3. 재료 투입 플로우

### 3.1 단일 재료 투입 (AmountInputPopup)

```
┌──────────────────────────────────────┐
│   사용자: 냉장고/서랍/조미료대 클릭   │
└───────────┬──────────────────────────┘
            │
            ▼
┌────────────────────────────────────────┐
│       GridPopup (재료 선택)            │
│                                        │
│  [양파]  [당근]  [애호박]             │
│  [돼지]  [계란]  [밥]                 │
│                                        │
│  단일 선택 모드                        │
└───────────┬────────────────────────────┘
            │
            ▼ [재료 1개 선택]
┌────────────────────────────────────────┐
│     AmountInputPopup (양 입력)         │
│                                        │
│  🥕 당근 (요구량: 30g 표시)           │
│                                        │
│  화구1: [30] g  ✅ (레시피 일치)      │
│  화구2: [  ] g                         │
│  화구3: [  ] g                         │
│                                        │
│  [확인]  [취소]                        │
│                                        │
│  키보드 단축키:                        │
│  - Enter: 확인                         │
│  - ESC: 취소                           │
│  - Tab: 다음 입력 필드                 │
└───────────┬────────────────────────────┘
            │
            ▼ [확인 클릭]
┌────────────────────────────────────────┐
│        각 화구별로 검증 & 투입         │
│                                        │
│  화구1: validateAndAdvanceIngredient() │
│         ├─→ 정확함: addedIngredients++ │
│         └─→ 틀림: 오류 처리            │
│                                        │
│  화구2: 양이 0 → 스킵                  │
│  화구3: 양이 0 → 스킵                  │
└───────────┬────────────────────────────┘
            │
            ▼
┌────────────────────────────────────────┐
│          결과 토스트 표시              │
│                                        │
│  "✅ 모두 정확합니다! (1개 웍)"        │
│  또는                                  │
│  "❌ 틀렸습니다! (1개 웍)"             │
└────────────────────────────────────────┘
```

### 3.2 배치 재료 투입 (BatchAmountInputPopup)

```
┌──────────────────────────────────────┐
│   사용자: 냉장고/서랍 클릭            │
└───────────┬──────────────────────────┘
            │
            ▼
┌────────────────────────────────────────┐
│       GridPopup (재료 선택)            │
│                                        │
│  다중 선택 모드 활성화                 │
│                                        │
│  ☑ 양파   ☑ 당근   ☐ 애호박          │
│  ☑ 돼지   ☐ 계란   ☐ 밥              │
│                                        │
│  [여러 개 선택 후 확인]                │
└───────────┬────────────────────────────┘
            │
            ▼ [선택 완료]
┌────────────────────────────────────────┐
│   BatchAmountInputPopup (양 입력)      │
│                                        │
│         화구1   화구2   화구3          │
│  양파   [50]g   [  ]g   [30]g         │
│  당근   [30]g   [20]g   [  ]g         │
│  돼지   [100]g  [  ]g   [  ]g         │
│                                        │
│  레시피 일치 여부 실시간 표시:         │
│  ✅ 정확   ⚠️ 부정확   ⬜ 미입력       │
│                                        │
│  [확인]  [취소]                        │
└───────────┬────────────────────────────┘
            │
            ▼ [확인 클릭]
┌────────────────────────────────────────┐
│      모든 조합에 대해 검증 & 투입      │
│                                        │
│  화구1: 양파 50g → 검증 & 투입         │
│         당근 30g → 검증 & 투입         │
│         돼지 100g → 검증 & 투입        │
│                                        │
│  화구2: 당근 20g → 검증 & 투입         │
│                                        │
│  화구3: 양파 30g → 검증 & 투입         │
└───────────┬────────────────────────────┘
            │
            ▼
┌────────────────────────────────────────┐
│          결과 토스트 표시              │
│                                        │
│  "✅ 모두 정확합니다! (6개 투입)"      │
│  또는                                  │
│  "⚠️ 3개 성공, 2개 오류"               │
└────────────────────────────────────────┘
```

---

## 4. 온도 관리 플로우

### 4.1 온도 상승 & 상태 전환

```
[불 켜짐] (isOn: true)
      │
      ▼ (매 1초마다)
┌─────────────────────────────────────┐
│   온도 계산 (지수 곡선)              │
│                                     │
│  heatRate = BASE_HEAT_RATE          │
│            × HEAT_MULTIPLIER[level] │
│            × (tempRatio ^ 2)        │
│                                     │
│  temperature += heatRate            │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│        온도 구간별 상태 전환         │
└─────┬───────────────────────────────┘
      │
      ├─→ [25~179°C] 안전 구간
      │   └─→ UI: 파란색 게이지
      │
      ├─→ [180~299°C] 볶기 가능
      │   ├─→ UI: 노란색 게이지
      │   └─→ "볶기" 버튼 활성화
      │
      ├─→ [300~359°C] 스모킹 포인트
      │   ├─→ UI: 주황색 게이지
      │   ├─→ 연기 애니메이션 💨
      │   └─→ 경고 없음
      │
      ├─→ [360~399°C] 과열
      │   ├─→ state: OVERHEATING
      │   ├─→ UI: 빨간색 게이지
      │   ├─→ 웍 테두리 주황색 깜빡임
      │   └─→ 경고 메시지 표시
      │
      └─→ [400°C+] 타버림
          ├─→ state: BURNED
          ├─→ UI: 검은색 웍
          ├─→ 조리 중이던 메뉴 취소
          │   └─→ MenuOrder status: WAITING
          └─→ 웍 사용 불가
              └─→ 설거지 필요
```

### 4.2 불 세기 조절

```
┌──────────────────────────────────────┐
│   사용자: 웍 클릭 (래디얼 메뉴)       │
└───────────┬──────────────────────────┘
            │
            ▼
┌────────────────────────────────────────┐
│       불 세기 버튼 (하단)              │
│                                        │
│    [약불]  [중불]  [강불]             │
│     ×0.78  ×1.56  ×1.82               │
│                                        │
│  현재 선택: 강불 (ring 표시)          │
└───────────┬────────────────────────────┘
            │
            ▼ [사용자: 중불 선택]
┌────────────────────────────────────────┐
│       setHeatLevel(burnerNumber, 2)    │
│                                        │
│  다음 온도 계산부터 중불 배율 적용     │
│  (heatMultiplier = 1.56)              │
└────────────────────────────────────────┘

[온도 상승 속도 비교]
┌────────────────────────────────────────┐
│  25°C → 100°C 도달 시간:              │
│                                        │
│  약불 (×0.78):  약 15초               │
│  중불 (×1.56):  약 10초               │
│  강불 (×1.82):  약 8초                │
│                                        │
│  ⚠️ 강불은 빠르지만 과열 위험 있음    │
└────────────────────────────────────────┘
```

### 4.3 재료 투입 시 온도 하락

```
[재료 투입]
      │
      ├─→ 재료 카테고리 판단 (SKU 기반)
      │   │
      │   ├─→ 채소류 (양파/당근/애호박)
      │   │   └─→ temperature -= 40°C
      │   │
      │   ├─→ 해산물 (새우/오징어)
      │   │   └─→ temperature -= 45°C
      │   │
      │   ├─→ 계란
      │   │   └─→ temperature -= 20°C
      │   │
      │   ├─→ 밥
      │   │   └─→ temperature -= 15°C
      │   │
      │   └─→ 조미료
      │       └─→ temperature -= 5°C
      │
      ▼
┌────────────────────────────────────────┐
│     온도 하락 애니메이션 (선택)        │
│                                        │
│  현재 온도: 250°C                      │
│     ↓                                  │
│  새 온도: 210°C (-40°C)                │
│                                        │
│  게이지가 부드럽게 하강                │
└────────────────────────────────────────┘
```

---

## 5. 예외 상황 플로우

### 5.1 웍이 타버렸을 때

```
[온도 400°C 도달]
      │
      ▼
┌─────────────────────────────────────┐
│     웍 상태: BURNED                 │
│                                     │
│  ① 현재 조리 중인 메뉴 취소         │
│     - MenuOrder status: WAITING     │
│     - 다시 주문 대기열에 표시       │
│                                     │
│  ② 웍 초기화                        │
│     - currentMenu: null             │
│     - currentStep: 0                │
│     - isOn: false                   │
│                                     │
│  ③ UI 변경                          │
│     - 웍 색상: 검은색               │
│     - "설거지 필요" 표시            │
└─────┬───────────────────────────────┘
      │
      ▼ [사용자 인지]
┌─────────────────────────────────────┐
│   옵션 1: 설거지 후 재사용          │
│   │                                 │
│   └─→ 싱크대로 이동 → 설거지        │
│       └─→ state: WET                │
│           └─→ 말리기 (180°C)        │
│               └─→ state: CLEAN      │
│                                     │
│   옵션 2: 다른 웍 사용              │
│   └─→ 깨끗한 웍에 메뉴 재배정       │
└─────────────────────────────────────┘
```

### 5.2 메뉴 타이머 초과 (15분)

```
[메뉴 타이머 체크] (매 1초마다)
      │
      ▼
┌─────────────────────────────────────┐
│  elapsedTime > 15분?                │
└─────┬───────────────────┬───────────┘
      │                   │
     No                  Yes
      │                   │
      └─→ 계속 진행        ▼
                    ┌──────────────────────┐
                    │  주문 자동 취소       │
                    │                      │
                    │ ① 조리 중인 웍 찾기  │
                    │    - state: DIRTY    │
                    │    - currentMenu: null│
                    │                      │
                    │ ② 메뉴큐에서 제거    │
                    │                      │
                    │ ③ 로그 기록          │
                    │    "MENU_CANCELLED"  │
                    │                      │
                    │ ④ 점수 감점          │
                    │    -50점             │
                    └──────────────────────┘
```

### 5.3 잘못된 재료 투입 시

```
[재료 투입 시도]
      │
      ▼
┌─────────────────────────────────────┐
│   레시피 검증                        │
│                                     │
│  required_sku === input_sku?        │
│  required_amount === input_amount?  │
└─────┬───────────────────┬───────────┘
      │                   │
     ✅                  ❌
      │                   │
      ▼                   ▼
┌──────────────┐   ┌────────────────────┐
│  투입 성공   │   │   투입 실패        │
│              │   │                    │
│스텝 진행     │   │ [난이도 분기]      │
└──────────────┘   └────┬───────────────┘
                        │
            ┌───────────┴───────────┐
            │                       │
        [신입 모드]            [알바/관리자]
            │                       │
            ▼                       ▼
    ┌──────────────┐        ┌──────────────┐
    │  즉시 차단   │        │ 오류 카운트++│
    │              │        │              │
    │경고 토스트:  │        │진행 허용     │
    │"틀린 재료!"  │        │              │
    │              │        │서빙 시       │
    │다시 입력 대기│        │정확도 표시   │
    └──────────────┘        └──────────────┘
```

---

## 6. 화면 전환 플로우

### 6.1 난이도 선택 → 게임 플레이

```
[난이도 선택 화면]
      │
      ▼ [사용자: 신입 선택]
┌─────────────────────────────────────┐
│   setLevel('BEGINNER')              │
│   targetMenus = 3                   │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│   preloadStorageData(storeId)       │
│                                     │
│  - 모든 냉장고/서랍 데이터 로드     │
│  - storageCache에 저장              │
│  - 로딩 화면 표시 (2~3초)          │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│   startGame()                       │
│                                     │
│  - Supabase game_sessions INSERT    │
│  - isPlaying = true                 │
│  - navigate('/game')                │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│   [게임 플레이 화면]                │
│                                     │
│  - 타이머 시작 (tickTimer)          │
│  - 주문 생성 시작 (30초마다)        │
│  - 온도 업데이트 시작 (1초마다)     │
│  - 화구 사용 기록 (1초마다)         │
└─────────────────────────────────────┘
```

### 6.2 게임 플레이 → 결과 화면

```
[게임 플레이 중]
      │
      ▼ [completedMenus >= targetMenus]
┌─────────────────────────────────────┐
│   endGame()                         │
│                                     │
│  ① 점수 계산                        │
│     - 레시피 정확도                 │
│     - 속도 점수                     │
│     - 화구 효율                     │
│                                     │
│  ② Supabase 저장                    │
│     - game_sessions UPDATE          │
│     - game_scores INSERT            │
│                                     │
│  ③ isPlaying = false                │
│                                     │
│  ④ navigate('/result')              │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│   [결과 화면]                       │
│                                     │
│  📊 상세 점수 표시:                 │
│     - 레시피 정확도: 95%            │
│     - 속도 점수: 87점               │
│     - 화구 효율: 78%                │
│     - 총점: 92점                    │
│                                     │
│  🏆 등급:                           │
│     - S (95~100)                    │
│     - A (85~94)                     │
│     - B (70~84)                     │
│     - C (50~69)                     │
│     - D (0~49)                      │
│                                     │
│  [다시 하기] → navigate('/level')  │
│  [메인으로] → navigate('/')         │
└─────────────────────────────────────┘
```

---

## 7. 상호작용 흐름도

### 7.1 냉장고 열기 → 재료 선택

```
[메인 화면] (GamePlay.tsx)
      │
      ├─→ [4호박스 클릭]
      │   │
      │   ▼
      │   ┌────────────────────────────┐
      │   │ openFridgeZoom('FRIDGE_ALL')│
      │   │ fridgeViewState: 'ZOOMED'  │
      │   └────┬───────────────────────┘
      │        │
      │        ▼
      │   ┌────────────────────────────┐
      │   │  2x2 칸 표시               │
      │   │  [LT] [RT]                 │
      │   │  [LB] [RB]                 │
      │   └────┬───────────────────────┘
      │        │
      │        ▼ [사용자: LT 선택]
      │   ┌────────────────────────────┐
      │   │  층 선택 버튼 표시         │
      │   │  [1층] [2층]               │
      │   └────┬───────────────────────┘
      │        │
      │        ▼ [사용자: 1층 선택]
      │   ┌────────────────────────────┐
      │   │  GridPopup 열림            │
      │   │  (storageCache에서 로드)   │
      │   │                            │
      │   │  재료 그리드 표시 (3x2)    │
      │   └────┬───────────────────────┘
      │        │
      │        ▼ [재료 선택 & 확인]
      │   ┌────────────────────────────┐
      │   │  fridgeViewState: 'CLOSED' │
      │   │  handleSelectIngredient()  │
      │   └────────────────────────────┘
      │
      └─→ [서랍 냉장고 클릭]
          └─→ (동일한 흐름, storageCache 사용)
```

### 7.2 래디얼 메뉴 상호작용

```
[게임 플레이 중]
      │
      ▼ [사용자: 웍 클릭]
┌─────────────────────────────────────┐
│   showRadialMenu = true             │
│   z-index: 102 (최상위)             │
│                                     │
│   배경 오버레이: bg-black/50        │
└─────┬───────────────────────────────┘
      │
      ▼
┌─────────────────────────────────────┐
│   [래디얼 메뉴 표시]                │
│                                     │
│         [볶기 🍳]                    │
│            ↑                        │
│ [물넣기 💧] ← 웍 → [뒤집기 🔄]      │
│            ↓                        │
│   [약불 중불 강불 🔥]               │
│                                     │
│  모든 버튼 동시 표시 (0.15s)        │
└─────┬───────────────────────────────┘
      │
      ├─→ [사용자: 볶기 클릭]
      │   │
      │   ├─→ startStirFry(burnerNumber)
      │   │   └─→ 온도 180°C 이상?
      │   │       ├─→ Yes: isStirFrying = true
      │   │       │         불 애니메이션 🔥
      │   │       │         1초 후 온도 -10°C
      │   │       │
      │   │       └─→ No: 경고 토스트
      │   │
      │   └─→ validateAndAdvanceAction()
      │       └─→ 레시피 검증 & 스텝 진행
      │
      ├─→ [사용자: 불 세기 클릭]
      │   └─→ setHeatLevel(burnerNumber, level)
      │       └─→ 다음 온도 계산부터 적용
      │
      ├─→ [ESC 키 누름]
      │   └─→ showRadialMenu = false
      │
      ├─→ [외부 클릭]
      │   └─→ showRadialMenu = false
      │
      └─→ [액션 실행 후]
          └─→ showRadialMenu = false (자동)
```

---

**문서 버전**: 1.0  
**마지막 업데이트**: 2026-02-01  
**작성자**: Kitchen Simulator Team
